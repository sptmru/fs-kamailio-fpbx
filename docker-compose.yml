services:
  kamailio:
    image: kamailio/kamailio-ci:5.4
    container_name: kamailio
    restart: unless-stopped
    volumes:
      - "${PWD}/kamailio:/etc/kamailio:rw"
    networks:
      nw-default:
        ipv4_address: 10.1.0.200
    ports:
      - "${KAMAILIO_PORT:-5060}:${KAMAILIO_PORT:-5060}/udp"
      - "${KAMAILIO_PORT:-5060}:${KAMAILIO_PORT:-5060}"
  freeswitch_one:
    container_name: freeswitch_one
    build:
      context: ./freeswitch
      dockerfile: Dockerfile
    volumes:
      - freeswitch_one_conf:/usr/local/freeswitch/conf
      - "${PWD}/freeswitch/conf:/mnt/conf:ro"
    restart: unless-stopped
    expose:
      - "5080/udp"
      - "5080"
      - "8021"
    environment:
      - EXTENSION_PASSWORD=1234
    networks:
      nw-default:
        ipv4_address: 10.1.0.101
    entrypoint: ["/bin/sh", "-c", "cp -r /mnt/conf/* /usr/local/freeswitch/conf && exec /usr/local/bin/entrypoint.sh"]
  freeswitch_two:
    container_name: freeswitch_two
    build:
      context: ./freeswitch
      dockerfile: Dockerfile
    volumes:
      - freeswitch_two_conf:/usr/local/freeswitch/conf
      - "${PWD}/freeswitch/conf:/mnt/conf:ro"
    restart: unless-stopped
    expose:
      - "5080/udp"
      - "5080"
      - "8021"
    environment:
      - EXTENSION_PASSWORD=1234
    networks:
      nw-default:
        ipv4_address: 10.1.0.102
    entrypoint: ["/bin/sh", "-c", "cp -r /mnt/conf/* /usr/local/freeswitch/conf && exec /usr/local/bin/entrypoint.sh"]
  fusionpbx_one:
    container_name: fusionpbx_one
    build:
      context: ./fusionpbx
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "8081:80"
    volumes:
      - freeswitch_one_conf:/etc/freeswitch
    networks:
      nw-default:
        ipv4_address: 10.1.0.11
  fusionpbx_two:
    container_name: fusionpbx_two
    build:
      context: ./fusionpbx
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "8082:80"
    volumes:
      - freeswitch_two_conf:/etc/freeswitch
    networks:
      nw-default:
        ipv4_address: 10.1.0.12
  postgres_one:
    container_name: postgres_one
    image: postgres:16.1
    environment:
      POSTGRES_USER: ${DB_USERNAME}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: ${DB_NAME}
    volumes:
      - postgres_one_volume:/var/lib/postgresql/data
    expose:
      - "5432"
    restart: unless-stopped
    networks:
      nw-default:
        ipv4_address: 10.1.0.21
  postgres_two:
    container_name: postgres_two
    image: postgres:16.1
    environment:
      POSTGRES_USER: ${DB_USERNAME}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: ${DB_NAME}
    volumes:
      - postgres_two_volume:/var/lib/postgresql/data
    expose:
      - "5432"
    restart: unless-stopped
    networks:
      nw-default:
        ipv4_address: 10.1.0.22
networks:
  nw-default:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 10.1.0.0/24
volumes:
  postgres_one_volume: {}
  postgres_two_volume: {}
  freeswitch_one_conf: {}
  freeswitch_two_conf: {}
